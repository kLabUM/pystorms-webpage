
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>pyswmm functionality &#8212; pystorms 0.6.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">pystorms</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="GettingStarted.html">
  Welcome to the
  <code class="docutils literal notranslate">
   <span class="pre">
    pystorms
   </span>
  </code>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="Scenarios.html">
  Scenarios
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/kLabUM/pystorms" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example">
   Example
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="pyswmm-functionality">
<h1><code class="docutils literal notranslate"><span class="pre">pyswmm</span></code> functionality<a class="headerlink" href="#pyswmm-functionality" title="Permalink to this headline">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pystorms</span></code> is built on <code class="docutils literal notranslate"><span class="pre">pyswmm</span></code>. It uses <code class="docutils literal notranslate"><span class="pre">pyswmm</span></code> as its back-end
for interacting with EPA-SWMM’s computational engine. Hence, all the
functionality in <code class="docutils literal notranslate"><span class="pre">pyswmm</span></code> is inherently available in <code class="docutils literal notranslate"><span class="pre">pystorms</span></code>.
<code class="docutils literal notranslate"><span class="pre">pystorms</span></code> by defaults supports a subset of the states though its API.
These subsets of states (i.e. depth, flows, inflows) were chosen to
represent frequently used parameters for making control decisions. Refer
to the documentation on states for more details on the supported
parameters. <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> architecture is designed to enable users easy
access to all the existing pyswmm functionality.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pystorms</span>
<span class="kn">import</span> <span class="nn">pyswmm.toolkitapi</span> <span class="k">as</span> <span class="nn">tkai</span>
</pre></div>
</div>
<p>This example demonstrates how pyswmm functionality can be invoked from
<cite>pystorms</cite>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">pystorms</span><span class="o">.</span><span class="n">scenarios</span><span class="o">.</span><span class="n">theta</span><span class="p">()</span>
</pre></div>
</div>
<p>All function calls being used in the environment for populating state
vector are listed in the <code class="docutils literal notranslate"><span class="pre">env.env.methods</span></code> dictionary.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">methods</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;depthN&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getNodeDepth</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;depthL&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getLinkDepth</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getLinkFlow</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;flooding&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getNodeFlooding</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;inflow&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getNodeInflow</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;pollutantN&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getNodePollutant</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">,</span>
 <span class="s1">&#39;pollutantL&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">bound</span> <span class="n">method</span> <span class="n">environment</span><span class="o">.</span><span class="n">_getLinkPollutant</span> <span class="n">of</span> <span class="o">&lt;</span><span class="n">pystorms</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">environment</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x11929d690</span><span class="o">&gt;&gt;</span><span class="p">}</span>
</pre></div>
</div>
<p>Let us say, we want to use volume as a state. All we have to do is add
the function call reading volume to the dict.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_getNodeVolume</span><span class="p">(</span><span class="n">NodeID</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">getNodeResult</span><span class="p">(</span><span class="n">NodeID</span><span class="p">,</span> <span class="n">tkai</span><span class="o">.</span><span class="n">NodeResults</span><span class="o">.</span><span class="n">newVolume</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>env</cite> refers to the scenario being initialized.
For example, if the scenario was initialized as <cite>sce</cite> the first class in the return statement would be <cite>sce</cite>. env in <cite>&lt;scenario class&gt;.env</cite> refers to the environment class used to communicate with pyswmm/EPA-SWMM.
<cite>sim._model</cite> refers to the EPA-SWMM simulation initialized by invoking the scenario class.
<cite>getNodeResult</cite> is the functional call that queries the volume from the EPA-SWMM.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="s2">&quot;volumeN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_getNodeVolume</span>
</pre></div>
</div>
<p>Lets add volume to the state vector</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;depthN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;depthN&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;volumeN&#39;</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;volumeN&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p><em>NOTE:</em> Arguments to the volume function are tuple appended to the config dict. Refer to <a class="reference external" href="https://github.com/kLabUM/pystorms/blob/ffa3564ef5f80811ca246b10ffeb0e38f36befdb/pystorms/environment.py#L74">environment.py</a> for more details on how state vector is populated.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;depthN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;depthN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;P1&#39;</span><span class="p">,</span> <span class="s1">&#39;volumeN&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;P2&#39;</span><span class="p">,</span> <span class="s1">&#39;volumeN&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now when <code class="docutils literal notranslate"><span class="pre">env.state()</span></code> is called, it returns all both depth and volume
in nodes</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
</pre></div>
</div>
<p>Refer to pyswmm documentation for details on the all supported
parameters.</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pystorms</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyswmm.toolkitapi</span> <span class="k">as</span> <span class="nn">tkai</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="c1"># Create the function call for reading volume</span>
<span class="k">def</span> <span class="nf">getNodeVolume</span><span class="p">(</span><span class="n">NodeID</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">getNodeResult</span><span class="p">(</span><span class="n">NodeID</span><span class="p">,</span> <span class="n">tkai</span><span class="o">.</span><span class="n">NodeResults</span><span class="o">.</span><span class="n">newVolume</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="c1"># Initalize scenario</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">pystorms</span><span class="o">.</span><span class="n">scenarios</span><span class="o">.</span><span class="n">theta</span><span class="p">()</span>

<span class="c1"># Update the methods dict</span>
<span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">methods</span><span class="p">[</span><span class="s2">&quot;volumeN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getNodeVolume</span>
<span class="c1"># Update state vector</span>
<span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="s2">&quot;volumeN&quot;</span><span class="p">))</span>
<span class="n">env</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;states&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;P2&quot;</span><span class="p">,</span> <span class="s2">&quot;volumeN&quot;</span><span class="p">))</span>

<span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">state</span><span class="p">()</span>
    <span class="n">done</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;depthP1&quot;</span><span class="p">,</span> <span class="s2">&quot;depthP2&quot;</span><span class="p">,</span> <span class="s2">&quot;volumeP1&quot;</span><span class="p">,</span> <span class="s2">&quot;volumeP2&quot;</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2049.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>