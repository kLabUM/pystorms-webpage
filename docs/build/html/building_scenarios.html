
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Building Custom Scenarios &#8212; pystorms 1.0.0 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced" href="advanced.html" />
    <link rel="prev" title="Scenarios" href="scenarios.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">pystorms</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="getting_started.html">
  <code class="docutils literal notranslate">
   <span class="pre">
    pystorms
   </span>
  </code>
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="scenarios.html">
  Scenarios
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Building Custom Scenarios
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="advanced.html">
  Advanced
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="contributing.html">
  Contributing
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/kLabUM/pystorms" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/pystorms/" rel="noopener" target="_blank" title="PyPI"><span><i class="fas fa-box"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#anonymize-the-stormwater-network">
   Anonymize the stormwater network
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anonymization-procedure">
     Anonymization procedure
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#event-driver">
   Event driver
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#control-objective-and-performance-metric">
   Control objective and performance metric
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-the-state-and-action-space">
   Choose the state and action space
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-pystorms-scenario-class">
   Building
   <code class="docutils literal notranslate">
    <span class="pre">
     pystorms
    </span>
   </code>
   scenario class
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="building-custom-scenarios">
<h1>Building Custom Scenarios<a class="headerlink" href="#building-custom-scenarios" title="Permalink to this headline">#</a></h1>
<p>Developing custom scenarios for contributing to the <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> library or your personal use is really easy.</p>
<p><strong>Steps for building a custom scenarios</strong></p>
<ol class="arabic simple">
<li><p>Anonymize the stormwater network, if you are considering contributing to the <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> repository.</p></li>
<li><p>Identify the event drivers (e.g. stormevents, tides).</p></li>
<li><p>Choose an objective and performance metric for evaluating the objective.</p></li>
<li><p>Decide on the state and action space.</p></li>
<li><p>Build the class and populate the yaml file.</p></li>
</ol>
<section id="anonymize-the-stormwater-network">
<h2>Anonymize the stormwater network<a class="headerlink" href="#anonymize-the-stormwater-network" title="Permalink to this headline">#</a></h2>
<p>To ensure that the stormwater network is anonymized, we apply randomized
transformations on the network that transform the coordinates of the
network, while maintaining the integrity of the network topology.</p>
<p>In a SWMM input file the geometry of the model elements (length, elevation, cross section, etc.,) and their coordinate locations (i.e. the location to be displayed in the visualization of the model in a program) are defined in separate sections.
This separation allows the transformation of the coordinate data without altering the geometry of the model elements.
This means that the coordinates of the model elements can be rotated, scaled, and translated without effecting any of the geometry values relevant to the execution of the model.</p>
<section id="anonymization-procedure">
<h3>Anonymization procedure<a class="headerlink" href="#anonymization-procedure" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>Rotate</strong> all coordinates by a common (random) angle between 0 and 360 degrees. This randomly generated rotation angle is not exposed.</p></li>
<li><p><strong>Scale</strong> all coordinates such that they are within a 100,000 x 100,000 unit box.</p></li>
<li><p><strong>Translate</strong> coordinates to be within the bounding box defined by its two corners of (0,0) and (100000, 100000).</p></li>
<li><p><strong>Output</strong> the anonymized coordinates to a new SWMM input file. By default comments are scrubbed from the input file, therefore no identifying metadata is kept in the anonymized version.</p></li>
<li><p><strong>Inspect</strong> anonymized SWMM input file for any identifiable information remaining.</p></li>
</ol>
</div></blockquote>
<p>More information on the anonymization routine and the code to do so can be found
<a class="reference external" href="https://github.com/kLabUM/AnonymizeINP/blob/master/AnonymizeFullRoutine.ipynb">here</a>.</p>
<p>Once the network is anonymized, the names of the nodes, links, or any components that can be traced back to the original model have to be updated.
Currently, we do not have a proper nomenclature style for renaming the network components, so we leave this up to the better judgement of the users.</p>
</section>
</section>
<section id="event-driver">
<h2>Event driver<a class="headerlink" href="#event-driver" title="Permalink to this headline">#</a></h2>
<p>The event driver can be a rainfall event, time series data of flows, or some initial volumes in nodes.
Basically, anything that is supported by the stormwater simulation engine.</p>
</section>
<section id="control-objective-and-performance-metric">
<h2>Control objective and performance metric<a class="headerlink" href="#control-objective-and-performance-metric" title="Permalink to this headline">#</a></h2>
<p>The performance measure quantifies the ability of the control algorithm in achieving its objective.
For example, if your objective was to minimize the CSO volume, a performance measure could be the CSO volume that occurs with the implementation of control.</p>
</section>
<section id="choose-the-state-and-action-space">
<h2>Choose the state and action space<a class="headerlink" href="#choose-the-state-and-action-space" title="Permalink to this headline">#</a></h2>
<p>After choosing an appropriate performance measure for quantifying the control objective, pick the states (i.e., the network elements where certain states, such as flow, water level, or pollutant concentrations, are measured) and the action space (i.e., controllable network assets).</p>
</section>
<section id="building-pystorms-scenario-class">
<h2>Building <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> scenario class<a class="headerlink" href="#building-pystorms-scenario-class" title="Permalink to this headline">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MyAwesomeScenario</span><span class="p">:</span> <span class="c1"># Choose a name for your Scenario</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    description of scenario</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    &lt; make a note of any new methods implemented for the class &gt;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &lt; any additional information you would want to provide about the scenario &gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># The scenario class ideally should not take any arguments</span>

        <span class="c1"># Scenario meta data is defined in the yaml file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">PATH</span> <span class="o">+</span> <span class="s2">&quot;/config/&lt;scenario name&gt;.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">),</span> <span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span> <span class="c1"># Meta data is loaded into the class as a dict file, which can be modified by the users.</span>

        <span class="c1"># Load the network input file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;swmm_input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;swmm_input&quot;</span><span class="p">])</span>
        <span class="c1"># Refer to adding a network for more details on how to contribute a network to the library</span>

        <span class="c1"># Create the simulation environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create an object for logging data, this can include all the data being used for computing performance metrics and data that can be used for debugging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;performance_measure&quot;</span> <span class="p">:</span> <span class="p">[],</span>
                         <span class="s2">&quot;flows&quot;</span> <span class="p">:</span> <span class="p">{},</span>
                         <span class="s2">&quot;flooding&quot;</span> <span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Populate the data_log with elements whose measurements have to be recorded.</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;performance_targets&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span><span class="p">[</span><span class="n">attribute</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Step ahead and update the state</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

        <span class="c1"># A logger of the states, actions, performance targets, and any other useful information</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">()</span>

        <span class="c1"># Create a performance measure</span>
        <span class="n">__performance</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;performance_targets&quot;</span><span class="p">]:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Implement your performance evaluation here.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span><span class="p">[</span><span class="s2">&quot;performance_measure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__performance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">done</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="scenarios.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Scenarios</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="advanced.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Advanced</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>