

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building Custom Scenarios &mdash; pystorms 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing" href="Contributing.html" />
    <link rel="prev" title="pyswmm functionality" href="PyswmmFeatures.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pystorms
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Home.html">⛈ ⛈ Welcome to the <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> ⛈ ⛈</a></li>
</ul>
<p class="caption"><span class="caption-text">Scenarios:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Scenarios.html">Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioTheta.html">Scenario Theta</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioAlpha.html">Scenario Alpha</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioBeta.html">Scenario Beta</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioGamma.html">Scenario Gamma</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioDelta.html">Scenario Delta</a></li>
<li class="toctree-l1"><a class="reference internal" href="ScenarioEpsilon.html">Scenario Epsilon</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="StateVectors.html">Defining States</a></li>
<li class="toctree-l1"><a class="reference internal" href="PyswmmFeatures.html"><code class="docutils literal notranslate"><span class="pre">pyswmm</span></code> functionality</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building Custom Scenarios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#anonymize-the-stormwater-network">Anonymize the stormwater network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#anonymization-procedure">Anonymization procedure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#event-driver">Event driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-objective-and-performance-metric">Control objective and performance metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choose-the-state-and-action-space">Choose the state and action space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-pystorms-scenario-class">Building <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> scenario class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Multiprocessing.html">Multi-processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Development</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pystorms</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Building Custom Scenarios</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/BuildingScenarios.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-custom-scenarios">
<h1>Building Custom Scenarios<a class="headerlink" href="#building-custom-scenarios" title="Permalink to this headline">¶</a></h1>
<p>Developing custom scenarios for contributing to the <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> library or your personal use is really easy.</p>
<p><strong>Steps for building a custom scenarios</strong></p>
<ol class="arabic simple">
<li><p>Anonymize the stormwater network, if you are considering contributing to the <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> repository.</p></li>
<li><p>Identify the event drivers (e.g. stormevents, tides).</p></li>
<li><p>Choose an objective and performance metric for evaluating the objective.</p></li>
<li><p>Decide on the state and action space.</p></li>
<li><p>Build the class and populate the yaml file.</p></li>
</ol>
<div class="section" id="anonymize-the-stormwater-network">
<h2>Anonymize the stormwater network<a class="headerlink" href="#anonymize-the-stormwater-network" title="Permalink to this headline">¶</a></h2>
<p>To ensure that the stormwater network is anonymized, we apply randomized
transformations on the network that transform the coordinates of the
network, while maintaining the integrity of the network topology.</p>
<p>In a SWMM input file the geometry of the model elements (length, elevation, cross section, etc.,) and their coordinate locations (i.e. the location to be displayed in the visualization of the model in a program) are defined in separate sections.
This separation allows the transformation of the coordinate data without altering the geometry of the model elements.
This means that the coordinates of the model elements can be rotated, scaled, and translated without effecting any of the geometry values relevant to the execution of the model.</p>
<div class="section" id="anonymization-procedure">
<h3>Anonymization procedure<a class="headerlink" href="#anonymization-procedure" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>Rotate</strong> all coordinates by a common (random) angle between 0 and 360 degrees. This randomly generated rotation angle is not exposed.</p></li>
<li><p><strong>Scale</strong> all coordinates such that they are within a 100,000 x 100,000 unit box.</p></li>
<li><p><strong>Translate</strong> coordinates to be within the bounding box defined by its two corners of (0,0) and (100000, 100000).</p></li>
<li><p><strong>Output</strong> the anonymized coordinates to a new SWMM input file. By default comments are scrubbed from the input file, therefore no identifying metadata is kept in the anonymized version.</p></li>
<li><p><strong>Inspect</strong> anonymized SWMM input file for any identifiable information remaining.</p></li>
</ol>
</div></blockquote>
<p>More information on the anonymization routine and the code to do so can be found
<a class="reference external" href="https://github.com/kLabUM/AnonymizeINP/blob/master/AnonymizeFullRoutine.ipynb">here</a>.</p>
<p>Once the network is anonymized, the names of the nodes, links, or any components that can be traced back to the original model have to be updated.
Currently, we do not have a proper nomenclature style for renaming the network components, so we leave this up to the better judgement of the users.</p>
</div>
</div>
<div class="section" id="event-driver">
<h2>Event driver<a class="headerlink" href="#event-driver" title="Permalink to this headline">¶</a></h2>
<p>The event driver can be a rainfall event, time series data of flows, or some initial volumes in nodes.
Basically, anything that is supported by the stormwater simulation engine.</p>
</div>
<div class="section" id="control-objective-and-performance-metric">
<h2>Control objective and performance metric<a class="headerlink" href="#control-objective-and-performance-metric" title="Permalink to this headline">¶</a></h2>
<p>The performance measure quantifies the ability of the control algorithm in achieving its objective.
For example, if your objective was to minimize the CSO volume, a performance measure could be the CSO volume that occurs with the implementation of control.</p>
</div>
<div class="section" id="choose-the-state-and-action-space">
<h2>Choose the state and action space<a class="headerlink" href="#choose-the-state-and-action-space" title="Permalink to this headline">¶</a></h2>
<p>After choosing an appropriate performance measure for quantifying the control objective, pick the states (i.e., the network elements where certain states, such as flow, water level, or pollutant concentrations, are measured) and the action space (i.e., controllable network assets).</p>
</div>
<div class="section" id="building-pystorms-scenario-class">
<h2>Building <code class="docutils literal notranslate"><span class="pre">pystorms</span></code> scenario class<a class="headerlink" href="#building-pystorms-scenario-class" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MyAwesomeScenario</span><span class="p">:</span> <span class="c1"># Choose a name for your Scenario</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    description of scenario</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    &lt; make a note of any new methods implemented for the class &gt;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    &lt; any additional information you would want to provide about the scenario &gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># The scenario class ideally should not take any arguments</span>

        <span class="c1"># Scenario meta data is defined in the yaml file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">PATH</span> <span class="o">+</span> <span class="s2">&quot;/config/&lt;scenario name&gt;.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">),</span> <span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span> <span class="c1"># Meta data is loaded into the class as a dict file, which can be modified by the users.</span>

        <span class="c1"># Load the network input file.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;swmm_input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_network</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;swmm_input&quot;</span><span class="p">])</span>
        <span class="c1"># Refer to adding a network for more details on how to contribute a network to the library</span>

        <span class="c1"># Create the simulation environment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">environment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">ctrl</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

        <span class="c1"># Create an object for logging data, this can include all the data being used for computing performance metrics and data that can be used for debugging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;performance_measure&quot;</span> <span class="p">:</span> <span class="p">[],</span>
                         <span class="s2">&quot;flows&quot;</span> <span class="p">:</span> <span class="p">{},</span>
                         <span class="s2">&quot;flooding&quot;</span> <span class="p">:</span> <span class="p">{}}</span>

        <span class="c1"># Populate the data_log with elements whose measurements have to be recorded.</span>
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;performance_targets&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span><span class="p">[</span><span class="n">attribute</span><span class="p">][</span><span class="n">ID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="c1"># Step ahead and update the state</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>

        <span class="c1"># A logger of the states, actions, performance targets, and any other useful information</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">()</span>

        <span class="c1"># Create a performance measure</span>
        <span class="n">__performance</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;performance_targets&quot;</span><span class="p">]:</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Implement your performance evaluation here.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_log</span><span class="p">[</span><span class="s2">&quot;performance_measure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">__performance</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">done</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Contributing.html" class="btn btn-neutral float-right" title="Contributing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="PyswmmFeatures.html" class="btn btn-neutral float-left" title="pyswmm functionality" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2049

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>